<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>确认回收</title>
		<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0" />
		<script src="../static/js/common.js"></script>
		<link rel="stylesheet" href="../static/css/common/reset.min.css" />
		<link rel="stylesheet" href="../static/css/borrow_details.css" />
		<link rel="stylesheet" href="../static/css/common/mui.min.css" />
	</head>

	<body>
		<div class="borrow-details">
			<div class="borrow-content clearfix">
				<ul>
					<li>
						<span>回收设备</span>
						<span id="model"></span>
					</li>
				</ul>
				<ul>
					<li>
						<span>回收价</span>
						<span id="actualMoney"></span>
					</li>
				</ul>

				<ul>
					<li>
						<span>租期</span>
						<span id="productDay"></span>
					</li>
				</ul>
				<ul>
					<li>
						<span id="">租金</span>
						<span id="totalFee"></span>
					</li>
				</ul>
				<ul>
					<li>
						<span>到期回购价<img src="../static/img/ic_info.png" id="fee_question"></span>
						<span id="productMoney"></span>
					</li>
				</ul>
				<ul>
					<li>
						<span>收款账户</span>
						<span id="cardNo"></span>
					</li>
				</ul>
			</div>
			<div class="borrow-btn" data="1">
				<div class="borrow-word" onclick="apply()">
					申请下单
				</div>
			</div>
			<!--<div class="borrow-check">
				<div class="check-box">
					<span>
						<input type="checkbox" onchange="borrowAgreement(this)" class="input_check" id="check3" checked="checked">
						<label for="check3"></label>
					</span>
				</div>
				<div class="read-agreement">
					我已阅读并同意
					<a class="recycle" href="javascript:(0);">《回收协议》</a>
					<a href="javascript:(0);" class="rent">《租赁回购协议》</a>
				</div>
			</div>-->
		</div>
		<div class="agreement-model new ">
			<div class="agreement-box">
				<a class="platform_recovery_protocol" href="javascript:void(0);">《回收协议》</a>
				<a class="repurchase_plan" href="javascript:void(0);">《租赁回购协议》</a>
				<a href="javascript:void(0);" class="cancel-agreement">取消</a>
			</div>
		</div>

		<!-- 提交的loading -->
		<div class="modal" id="myModal3" style="display:none;">
			<div class="popup"><img class="photo" src="../static/img/loading.png" /></div>
		</div>
		<!-- 回购价描述 -->
		<div class="modal" id="myModal4" style="display:none;">
			<div class="popup"></div>
			<div class="details-dialog1">
				<div class="modal-content">
					<div class="details-modal-body fee-msg">
						到期回购价=回收价+租金
					</div>
					<div class="modal-footer">
						<p style="margin-bottom: 0;">知道了</p>
					</div>
				</div>
			</div>
		</div>
		<input type="hidden" id="data_productId" />
		<input type="hidden" id="data_productMoney" />
		<input type="hidden" id="data_productDay" />
		<script type="text/javascript" src="../static/js/common/jquery.min.js"></script>
		<script type="text/javascript" src="../static/js/common/mui.min.js"></script>
		<script type="text/javascript" src="../static/js/bridge.js?v=20180607"></script>
		<script>
			$('#fee_question').on('touchend', function(e) {
				$("#myModal4").css("display", "block");
			});
			$('.modal-footer p').on('touchend', function(e) {
				$(this).parents('.modal').fadeOut(300);
			});
			var domain = apiDomain();
			var webDomain = webDomain();
			var deviceMes = getDevice();
			var arr = deviceMes.split('|'); //截取原生字段
			initFee();

			function initFee() {
				var token = getToken();
				$.ajax({
					type: "post",
					url: domain + "order/order_confirm",
					dataType: "json",
					data: {
						token: token
					},
					success: function(result) {
						if(result.status == 4002) {
							closeAndOpen(0);
							closeAndOpen(1);
//							initFee();
							return;
						}
						if(result.status == 2000) {
							$("#model").text(arr[1] + "," + arr[2] + "G");
							$("#data_productId").val(result.data.productId);
							$("#data_productMoney").val(result.data.productMoney);
							$("#data_productDay").val(result.data.productDay);
							$("#productMoney").text(result.data.productMoney + "元");
							$("#productDay").text(result.data.productDay + "天");
							$("#totalFee").text(result.data.totalFee + "元");
							$("#actualMoney").text(result.data.actualMoney + "元");
							$("#cardNo").text(result.data.cardName + "(" + result.data.cardNo + ")");
						} else {
							mui.alert(result.message);
						}
					}
				});
			}

			function apply() {
				var token = getToken();

				var paramValue = '';
//				var selectArr = JSON.parse(localStorage.getItem('selectArr'));
//				if(selectArr != undefined && selectArr.length != 0) {
//					for(var i = 0; i < selectArr.length; i++) {
//						paramValue += selectArr[i].title + '^' + selectArr[i].value;
//						if(i!=selectArr.length-1){
//							paramValue +='|';
//						}
//					}
//				}
				$.ajax({
					type: "post",
					url: domain + "order/order_submit",
					dataType: "json",
					data: {
						token: token,
						productId: $("#data_productId").val(),
						productDay: $("#data_productDay").val(),
						productMoney: $("#data_productMoney").val(),
						paramValue: paramValue,
						phoneModel: arr[1],
						phoneMemory: arr[2],
						phoneType: getClientType()
					},
					success: function(result) {
						if(result.status == 4002) {
							closeAndOpen(1);
							initFee();
							return;
						}
						if(result.status == 2000) {
//							mui.alert("系统将在1小时内通过审核，给我们的服务五星好评，通过率更高哦~", "提示", function() {
//								try {
//									goAppStore();
//									closeAndOpen(3); //转到我的
//								} catch(e) {
//									//TODO handle the exception
//								}
//							});
							mui.alert("提单成功，系统将在1小时内通过审核", "提示", function() {
								try {
									closeAndOpen(3); //转到我的
								} catch(e) {
									//TODO handle the exception
								}
							});
						} else {
							mui.alert(result.message, "提示", function() {
								try {
									closeAndOpen(2); //转到首页
								} catch(e) {
									//TODO handle the exception
								}
							});
						}
					}
				});
			}
			$(".recycle").click(function() {
				skipPage(0, webDomain + "agreement/recycle.html");
			});
			$(".rent").click(function() {
				skipPage(0, webDomain + "agreement/rent.html");
			});
		</script>
	</body>

</html>