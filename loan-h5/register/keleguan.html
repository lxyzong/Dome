<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>可乐白卡</title>
		<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0" />
		<script src="../static/js/common.js"></script>
		<link rel="stylesheet" href="../static/css/common/mui.min.css" />
		<link rel="stylesheet" href="../static/css/common/reset.min.css" />
		<link rel="stylesheet" href="../static/css/register.min.css" />
		<link rel="stylesheet" type="text/css" href="../static/css/swiper.min.css" />
		<link rel="stylesheet" type="text/css" href="../static/css/keleguan.css?v=2" />
	</head>

	<body>
		<div class="register-wrap">
			<div class="banner">
				<div class="div"><img src="../static/img/toutiao@2x.png" /><span>|</span>
					<div class="swiper-container">
						<div class="swiper-wrapper">
							<div class="swiper-slide">恭喜138****9028成功借款1500元！</div>
							<div class="swiper-slide">恭喜155****4895成功借款1200元！</div>
							<div class="swiper-slide">恭喜182****3869成功借款1400元！</div>
							<div class="swiper-slide">恭喜131****2325成功借款1000元！</div>
						</div>
					</div>
				</div>
			</div>
			<div class="from-wrap">
				<div class="user">
					<input type="number" placeholder="请输入手机号码" id="phone" class="phone">
				</div>
				<div class="user">
					<input type="text" placeholder="请设置登录密码" id="password" class="input">
				</div>
				<div class="identify-code">
					<input type="text" placeholder="请输入图形验证码" id="graph_code" class="input">
					<!-- 添加图片的src -->
					<img id="graph_code_img" onclick="changeGraphCode()">
				</div>
				<div class="pwd">
					<input type="number" placeholder="请输入验证码" id="phone_code" class="input">
					<input type="button" value="获取验证码" onclick="getPhoneCode()" class="randomCode">
				</div>
				<button class="resister" onclick="register()">查看我的额度</button>
			</div>
			<p>目前已有<span class="total">400000+</span>人在这里成功借到钱<span class="triangle"></span></p>
			<img src="../static/img/pic_map@2x.png">
		</div>
		<div id="myModal" style="display:none">
			<img src="../static/img/loading.png">
		</div>
		<script type="text/javascript" src="../static/js/common/jquery.min.js"></script>
		<script type="text/javascript" src="../static/js/common/mui.min.js"></script>
		<script type="text/javascript" src="../static/js/common.js"></script>
		<script src="../static/js/common/swiper.min.js"></script>
		<script src="https://s13.cnzz.com/z_stat.php?id=1274783725&web_id=1274783725" language="JavaScript"></script>
		<script>
			var _czc = _czc || [];
			_czc.push(["_setAccount", "1274783725"]);

			function push(alias, action, clientType, origin) {
				try {
					_czc.push(﻿["_trackEvent", clientType + "-" + origin, action]);
				} catch(e) {
					//TODO handle the exception
				}
			}
		</script>
		<script>
			var path = window.location.pathname;
			var start = path.lastIndexOf("\/");
			var end = path.lastIndexOf(".");
			var alias = path.substring(start + 1, end);
			var domain = apiDomain();
			var uuid = "";
			var clientType = getClientType();

			var origin_id = parseInt(GetQueryString("origin"));
			origin_id = isNaN(origin_id) ? clientType : origin_id;
			push(alias, "打开", clientType, origin_id)
			//获取图形验证码
			function changeGraphCode() {
				$.ajax({
					type: "post",
					url: domain + "web/graph_code",
					dataType: "json",
					data: {},
					success: function(data) {
						if(data.status == 2000) {
							uuid = data.data.uuid;
							$("#graph_code_img").attr("src", data.data.graph_code);
						}
					}
				});
			}
			changeGraphCode();
			//倒计时
			var countdown = 60;

			function settime() {
				var tt = setTimeout(function() {
					settime();
				}, 1000)
				if(countdown == 0) {
					clearTimeout(tt)
					$('.randomCode').val('获取验证码');
					countdown = 60;
					$('.randomCode').removeAttr('disabled');
					$('.randomCode').css({
						'background': '#ffc800'
					})
				} else {
					$('.randomCode').val("重新发送(" + countdown + "s)");
					countdown--;
					$('.randomCode').attr("disabled", "disabled");
				}
			}
			//获取验证码
			function getPhoneCode() {
				if(clientType == "ios") {
					mui.alert('暂不支持苹果手机');
					return;
				}
				push(alias, "验证码", clientType, origin_id);
				var phone = $("#phone").val();
				var graph_code = $("#graph_code").val();
				$.ajax({
					type: "post",
					url: domain + "web/mobile_code",
					dataType: "json",
					data: {
						alias: alias,
						phone: phone,
						graph_code: graph_code,
						uuid: uuid
					},
					success: function(data) {
						if(data.status == 2000) {
							settime();
							$('.randomCode').css({
								'background': '#bdbdbd'
							})
						} else if(data.status == 2001) {
							download();
						} else {
							changeGraphCode();
							mui.toast(data.message);
						}
					}
				});
			}
			//查看我的额度
			function register() {
				var phone = $("#phone").val();
				var phone_code = $("#phone_code").val();
				var password = $("#password").val();
				$.ajax({
					type: "post",
					url: domain + "web/register",
					dataType: "json",
					data: {
						alias: alias,
						phone: phone,
						password: password,
						phone_code: phone_code,
						origin_id: origin_id
					},
					beforeSend: function() {
						$('#myModal').show();
					},
					success: function(data) {
						if(data.status == 2000) {
							download();
						} else {
							mui.toast(data.message);
						}
					},
					complete: function() {
						$('#myModal').stop().hide();
					}
				});
			}
			var apk_url = "";
			var makert_url = "";
			try {
				$.ajax({
					type: "post",
					url: domain + "check_version",
					dataType: "json",
					data: {
						alias: alias,
						type: clientType,
						version: "1.0.0"
					},
					success: function(data) {
						if(data.status == 2000) {
							apk_url = data.data.versionUrl;
							makert_url = data.data.appMarket;
						}
					}
				});
			} catch(e) {
				//TODO handle the exception
			}

			function download() {
				var ua = navigator.userAgent.toLowerCase();
				if(/iphone|ipad|ipod/.test(ua)) {
					mui.alert('暂不支持苹果手机');
					return
				}
				if(/android/.test(ua)) {
					mui.alert('注册成功，点击确认下载', function() {
						push(alias, "下载", clientType, origin_id);
						if(makert_url) {
							window.location.href = makert_url;
							return;
						}
						if(apk_url) {
							window.location.href = apk_url;
							return;
						}
					});
					return
				}
				mui.alert('暂不支持该类型手机');
			}
			//input不能乱输
			var phone = /^(13[0-9]|14[579]|15[0-3,5-9]|16[6]|17[0135678]|18[0-9]|19[89])\d{8}$/;
			var verify = /^[A-Za-z0-9]+$/;
			$(".phone").blur(function() {
				if(phone.test($(this).val())) {} else {
					mui.toast('手机格式不对');
					$(this).val('')
				};
			});
			
			$(".phone").focus(function() {
				push(alias, "手机号", clientType, origin_id);
			});
			
			$(".input").keyup(function() {
				zz($(this));
			});
			
			$(".input").blur(function() {
				zz($(this));
			});

			function zz(that) {
				if(verify.test(that.val())) {} else {
					that.val('')
				}
			}
			//轮播.
			var mySwiper = new Swiper('.swiper-container', {
				direction: 'vertical',
				autoplay: 1500,
				loop: true,
				auto: true
			})
		</script>
	</body>

</html>