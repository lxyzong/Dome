<!DOCTYPE html>
<html>

	<head>
		<title>麻利贷</title>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=0" />
		<meta http-equiv="pragma" content="no-cache">
		<meta http-equiv="cache-control" content="no-cache">
		<meta http-equiv="expires" content="0">
		<link rel="stylesheet" type="text/css" href="static/css/common/reset.min.css" />
		<link rel="stylesheet" type="text/css" href="static/css/store_borrowing.css?v=20132" />
		<link rel="stylesheet" type="text/css" href="static/css/swiper.min.css" />
		<link rel="stylesheet" type="text/css" href="static/css/common/mui.min.css" />
	</head>

	<body>
		<div id="refreshContainer" class="mui-scroll-wrapper">
			<div class="more">
				<div>
					<i></i>
					<li>
						<a href="javascript:;" ontouchstart="apply('order/store_order_history.html')">我的记录</a>
					</li>
					<li>
						<a href="javascript:;" ontouchstart="apply('user/cert_center.html')">我的资料</a>
					</li>
					<li>
						<a href="javascript:;" ontouchstart="apply('user/bank_card.html')">银行卡</a>
					</li>
					<li>
						<a href="javascript:;" ontouchstart="apply('help_center.html')">帮助中心</a>
					</li>
				</div>
			</div>
			<div class="mui-scroll">
				<div class="body">
					<div class="kele_header">
						<i></i>
						<span></span>
						<div class="gmore"><i></i></div>
					</div>
					<div>
						<div class="banner">
							<img src="static/img/banner@2x.png?v=1" />
						</div>
						<div class="div">
							<img src="static/img/news@2x.png" /><span>|</span>
							<div class="swiper-container swiper-no-swiping">
								<div class="swiper-wrapper">
									<div class="swiper-slide">恭喜135XXXX4845用户成功借款2000元！</div>
									<div class="swiper-slide">恭喜155XXXX3652用户成功借款1000元！</div>
									<div class="swiper-slide">恭喜186XXXX3256用户成功借款3000元！</div>
									<div class="swiper-slide">恭喜131XXXX3466用户成功借款1200元！</div>
									<div class="swiper-slide">恭喜134XXXX3456用户成功借款1500元！</div>
								</div>
							</div>
						</div>

						<div class="main">
							<!--首页默认显示内容-->
							<div class="edu">
								<p>信用额度(元)</p>
								<p class="moe">1000-5000</p>
								<p class="server">填写身份资料即可借款</p>
								<button class="getcredits edu1">获取额度</button>
								<p class="p">目前已有50000+人在这里成功借款</p>
							</div>
							<!--审核失败-->
							<div class="shenhe">
								<div></div>
								<p>恭喜您通过初审</p>
								<p>鑫乐贷、朱八戒等多家优质资金方可供您借款服务</p>
								<button class="getcredits tiaoxuan">去挑选</button>
							</div>
							<!--逾期还款-->
							<div class="yh_main">
								<li class="li1">
									<p>待还款金额(元) <span>已逾期</span></p>
									<p class="jine"></p>
								</li>
								<li class="li2">
									<p>最迟还款日</p>
									<p class="riqi"></p>
								</li>
								<li class="li3">
									<p class="yuqi">您已逾期</p>
									<p class="datep"><span class="active active0"></span><span class="active active1"></span>天</p>
								</li>
								<li>
									<button class="getcredits repayment">立即还款</button>
								</li>
							</div>
							<div class="state" style="display: none;">
								<ul class="progress-of-borrow"></ul>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</body>
	<script src="static/js/common/jquery.min.js"></script>
	<script src="static/js/common.js"></script>
	<script src="static/js/bridge.js"></script>
	<script src="static/js/common/swiper.min.js"></script>
	<script src="static/js/common/mui.min.js"></script>
	<script>
		var aUrl = apiDomain();
		var webUrl = webDomain();
		default_display();

		function default_display() {
			var token = getToken();
			if(token) {
				$.ajax({
					type: "post",
					url: aUrl + "/order/loan_current_order",
					data: {
						token: token
					},
					async: true,
					dataType: 'JSON',
					success: function(data) {
						if(data.status != 2000) {
							loan_home();
							return
						}
						var obj = data.data;
						if(obj.orderStatus == 0 || obj.orderStatus == 1 || obj.orderStatus == 2) {
							window.location.replace(webUrl + 'market.html');
							return;
						};
						if(obj.orderStatus == 0) {
							loan_home();
						} else if(obj.orderStatus == 1) {
							displays('.edu', '.shenhe', '.yh_main', '.state');
							var process = data.data.loanBeforeList;
							var borrow = '';
							for(var i = 0; i < process.length; i++) {
								borrow += '<li>' +
									'<div class="clearfix">' +
									'<span></span>  ' +
									'<p>' + process[i].event + '</p>' +
									'<p>' + process[i].eventTime + '</p>' +
									'</div>' +
									'<p>' + process[i].eventDescribe + '</p>' +
									'</li>';
							}
							$('.progress-of-borrow').html(borrow);
						} else if(obj.orderStatus == 2) {
							displays('.edu', '.state', '.yh_main', '.shenhe');
						} else
						if(obj.orderStatus == 3) {
							displays('.edu', '.state', '.shenhe', '.yh_main');
							$('.li1 span').stop().hide();
							$(".yuqi").html('距离还款日还剩').css({
								'color': ' #666666'
							});
							$('.datep').find('span').addClass('active');
							detail(obj.shouldRepay, obj.lastRepayTime, obj.remainDays, obj.orderId);
						} else if(obj.orderStatus == 4) {
							displays('.edu', '.state', '.shenhe', '.yh_main');
							$('.li1 span').stop().show();
							$('.datep').find('span').removeClass('active');
							$(".yuqi").html('您已逾期').css({
								'color': '#FD664B'
							});
							detail(obj.shouldRepay, obj.lastRepayTime, obj.remainDays, obj.orderId);
						}
					}
				});
			} else {
				loan_home();
			};

		}

		function loan_home() {
			displays('.state', '.shenhe', '.yh_main', '.edu');
			var token = getToken();
			$.ajax({
				type: "post",
				url: aUrl + "/order/loan_home",
				data: {
					token: token,
				},
				async: true,
				dataType: 'JSON',
				success: function(data) {
					var obj = data.data;
					if(data.status == 2000) {
						if(obj.status == 2) {
							$(".server").css({
								'display': 'none'
							});
						}
						$('.moe').html(obj.amount);
						$('.server').html(obj.descTop);
						$('.edu1').html(obj.descMid);
						$('.p').html(obj.descBottom);
						$('.edu1').attr("data-edu", obj.url);
						$('.edu1').attr("data-status", obj.status);
					}
				}
			});
		};

		function displays(one, two, three, four) {
			$(one).css({
				'display': 'none'
			});
			$(two).css({
				'display': 'none'
			});
			$(three).css({
				'display': 'none'
			});
			$(four).css({
				'display': 'block'
			});
		};

		function detail(jine, riqi, date, aurl) {
			$('.jine').html(jine);
			$(".riqi").html(riqi);
			if(date >= 10) {
				var dai_shu = date;
				var dai_ge = dai_shu - ((Math.floor(dai_shu / 10)) * 10); //个位
				var dai_shi = (dai_shu - ((Math.floor(dai_shu / 100)) * 100) - dai_ge) / 10; //十位数
				$('.active1').html(dai_ge);
				$('.active0').html(dai_shi);
			} else {
				$('.active0').html(0);
				$('.active1').html(date);
			}
			$('.repayment').attr('data-orderId', aurl);
		}

		$(".edu1").on('touchstart', function() {
			var token = getToken();
			if(!token) {
				closeAndOpen(1);
				return;
			}
			var status = $(this).attr("data-status");
			var href = $(this).attr("data-edu");
			skipPage(0, href);
			if(status == 0) {
				mui.confirm('认证成功了吗？', '提示', ["是", "否"], function(e) {
					loan_home();
				})
			} else if(status == 1) {
				mui.confirm('银行卡绑定成功了吗？', '提示', ["是", "否"], function(e) {
					loan_home();
				})
			} else if(status == 2) {
				mui.confirm('提单成功了吗？', '提示', ["是", "否"], function(e) {
					default_display();
				})
			}
		});
		//审核失败
		$(".tiaoxuan").on('touchstart', function() {
			skipPage(0, webUrl + 'market.html');
		});
		//立即还款
		$('.repayment').on('touchstart', function() {
			var orderId = $(this).attr('data-orderId');
			skipPage(0, webUrl + 'order/store_order_detail.html?orderId=' + orderId);
			mui.confirm('还款成功了吗？', '提示', ["是", "否"], function(e) {
				if(e.index == 0) {
					default_display();
				} else {
					default_display();
				}
			})
		});
		//跳转方式
		function apply(url) {
			var token = getToken();
			if(!token) {
				closeAndOpen(1);
				return;
			}
			skipPage(0, webUrl + url);
		};

		//轮播.
		var mySwiper = new Swiper('.swiper-container', {
			direction: 'vertical',
			autoplay: 2000,
			loop: true,
			auto: true
		});
		//显示更多操作
		$(".gmore").on("touchstart", function() {
			$(".more").stop().show();
		});

		//隐藏更多操作
		$(".more").on('touchstart', function() {
			$(this).stop().hide();
		})
		//下拉刷新
		mui.init({
			pullRefresh: {
				container: "#refreshContainer", //下拉刷新容器标识，querySelector能定位的css选择器均可，比如：id、.class等
				down: {
					contentdown: "下拉可以刷新", //可选，在下拉可刷新状态时，下拉刷新控件上显示的标题内容
					contentover: "释放立即刷新", //可选，在释放可刷新状态时，下拉刷新控件上显示的标题内容
					contentrefresh: "正在刷新...", //可选，正在刷新状态时，下拉刷新控件上显示的标题内容
					callback: function() {
						setTimeout(function() {
							mui('#refreshContainer').pullRefresh().endPulldownToRefresh(false);
							default_display();
						}, 1000)

					}
				}
			}
		});
		scroll.options = {
			scrollY: true, //是否竖向滚动
			scrollX: false, //是否横向滚动
			startX: 0, //初始化时滚动至x
			startY: 0, //初始化时滚动至y 
			indicators: false, //是否显示滚动条
			deceleration: 0.0005, //阻尼系数,系数越小滑动越灵敏
			bounce: true //是否启用回弹
		}
	</script>

</html>