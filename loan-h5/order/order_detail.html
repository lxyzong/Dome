<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>订单详情</title>
		<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0" />
		<script src="../static/js/common.js"></script>
		<link rel="stylesheet" href="../static/css/common/reset.min.css" />
		<link rel="stylesheet" href="../static/css/common/mui.min.css" />
		<link rel="stylesheet" href="../static/css/repayed_details.css" />
	</head>

	<body>
		<div class="wrap">
			<div class="top">
				<p>订单进度</p>
				<!-- 注释，直接动态在ul插入就可以了，css是用选择器写的不用js判断 -->
				<ul class="progress-of-borrow"></ul>
			</div>
			<div class="bottom">
				<p>回收明细</p>
				<ul class="loan-details">
					<li>
						<span>回收机型</span>
						<span id="phoneModel"></span>
					</li>
					<li>
						<span>回收价</span>
						<span id="actualMoney"></span>
					</li>
					<li>
						<span>使用租金</span>
						<span id="totalFee"></span>
					</li>
					<li style="display: none;" class="overdueFee">
						<span>违约金</span>
						<span id="overdueFee"></span>
					</li>
					<li style="display: none;" class="reduceMoney">
						<span>减免金额</span>
						<span id="reduceMoney"></span>
					</li>
					<li>
						<span>回购总价</span>
						<span id="shouldRepay"></span>
					</li>
					<li>
						<span>收款银行</span>
						<span id="cardNo"></span>
					</li>
					<li>
						<span>回购日期</span>
						<span id="repayTime"></span>
					</li>
					<!--<li>
						<span>协议说明</span>
						<span><a class="recycle" href="javascript:(0);">《回收协议》</a><a href="javascript:(0);" class="rent">《租赁回购协议》</a></span>
					</li>-->
				</ul>
			</div>
			<input type="hidden" id="data_orderId" />
			<div class="btn-wrap">
				<button class="immediate-repayment" style="display: none;">立即回收</button>
			</div>
		</div>
		<div id="myModal" style="display:none">
			<img src="../static/img/loading.png">
		</div>
	</body>
	<script src="../static/js/common/jquery.min.js"></script>
	<script src="../static/js/common/mobiscroll.jquery.js"></script>
	<script type="text/javascript" src="../static/js/common/mui.min.js"></script>
	<script src="../static/js/bridge.js"></script>
	<script>
		var apiDomain = apiDomain();
		var webDomain = webDomain();
		var token = getToken();
		var orderId = request['orderId'];

		$.ajax({
			url: apiDomain + "order/order_records_detail",
			type: "post",
			dataType: "json",
			data: {
				token: token,
				orderId: orderId
			},
			success: function(data) {
				if(data.status == 2000) {
					var arr = data.data.phoneModel.split("|");
					$("#data_orderId").val(data.data.orderId);
					$("#phoneModel").text(arr[0] + "," + arr[1] + "G");
					$("#actualMoney").text(data.data.actualMoney + "元");
					$("#totalFee").text(data.data.borrowDay + "天，" + data.data.totalFee + "元");
					if(data.data.overdueDay != 0) {
						$("#overdueFee").text(data.data.overdueDay + "天，" + data.data.overdueFee + "元");
						$(".overdueFee").show();
					}
					if(data.data.reduceMoney != 0) {
						$("#reduceMoney").text(data.data.reduceMoney + "元");
						$(".reduceMoney").show();
					}
					$("#shouldRepay").text(data.data.shouldRepay + "元");

					$("#cardNo").text(data.data.cardNo);
					$("#repayTime").text(data.data.repayTime);
					var process = data.data.processList;
					for(var i = 0; i < process.length; i++) {
						$('.progress-of-borrow').append(
							'<li>' +
							'<div class="clearfix">' +
							'<span></span>  ' +
							'<p>' + process[i].event + '</p>' +
							'<p>' + process[i].eventTime + '</p>' +
							'</div>' +
							'<p>' + process[i].eventDescribe + '</p>' +
							'</li>')
					}
					if(data.data.status == 1) {
						$('.immediate-repayment').show();
					}
				}
			}
		});
		$('.immediate-repayment').click(function() {
			$.ajax({
				url: apiDomain + "order/repay_text",
				type: "post",
				dataType: "json",
				data: {
					token: token,
					orderId: $("#data_orderId").val()
				},
				beforeSend: function() {
					$('#myModal').show();
				},
				success: function(data) {
					if(data.status == 2000) {
						window.location.href = "order_repay.html?token=" + token + "&repayNo=" + data.data;
					} else {
						mui.alert(data.message);
					}
				},
				complete: function() {
					$('#myModal').stop().hide();
				}
			});
		});
		$(".recycle").click(function() {
			skipPage(0, webDomain + "agreement/recycle.html?id=" + orderId);
		});
		$(".rent").click(function() {
			skipPage(0, webDomain + "agreement/rent.html?id=" + orderId);
		});
	</script>

</html>