<!DOCTYPE html>
<html>

	<head>
		<title>首页</title>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=0" />
		<meta http-equiv="pragma" content="no-cache">
		<meta http-equiv="cache-control" content="no-cache">
		<meta http-equiv="expires" content="0">
		<link rel="stylesheet" type="text/css" href="static/css/common/reset.min.css" />
		<link rel="stylesheet" type="text/css" href="static/css/swiper.min.css" />
		<link rel="stylesheet" type="text/css" href="static/css/common/mui.min.css" />
		<link rel="stylesheet" type="text/css" href="static/css/stage_amortize.css" />
	</head>

	<body>
		<div id="refreshContainer" class="mui-scroll-wrapper">
			<div class="more">
				<div>
					<i></i>
					<li>
						<a href="javascript:;" ontouchstart="apply('order/store_order_history.html')">我的记录</a>
					</li>
					<li>
						<a href="javascript:;" ontouchstart="apply('user/cert_center.html')">我的资料</a>
					</li>
					<li>
						<a href="javascript:;" ontouchstart="apply('user/bank_card.html')">银行卡</a>
					</li>
					<li>
						<a href="javascript:;" ontouchstart="apply('help_center.html')">帮助中心</a>
					</li>
				</div>
			</div>
			<div class="mui-scroll">
				<div class="body">
					<div class="body_div">
						<div class="kele_header">
							<i></i>
							<span></span>
							<div class="gmore"><i></i></div>
						</div>
						<div>
							<div class="banner">
								<img src="static/img/stage_banner.png" />
							</div>
							<div class="div">
								<img src="static/img/news@2x.png" /><span>|</span>
								<div class="swiper-container swiper-no-swiping">
									<div class="swiper-wrapper">
										<div class="swiper-slide">恭喜182XXXX3597用户成功借款5000元！</div>
										<div class="swiper-slide">恭喜155XXXX2584用户成功借款10000元！</div>
										<div class="swiper-slide">恭喜186XXXX3256用户成功借款3000元！</div>
										<div class="swiper-slide">恭喜131XXXX3466用户成功借款8000元！</div>
										<div class="swiper-slide">恭喜150XXXX8512用户成功借款1000元！</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="main">
						<!--首页默认显示内容-->
						<div class="limit error" style="display: none;">
							<p>可借额度(元)</p>
							<div class="moeny">1000~10000</div>
							<p class="server">日利率0.098%</p>
							<button class="getcredits button">获取额度</button>
							<p class="p">填写资料即可借款</p>
						</div>
						<!--认证成功-->
						<div class="limit success" style="display: none;">
							<p>分期可借额度(元)</p>
							<div class="moeny">1500</div>
							<p class="server">日利率0.098%</p>
							<button class="getcredits button">立即借款</button>
							<p class="p"><img src="static/img/ic_light.png" /><span>本平台不向学生提供借款服务</span></p>
						</div>
						<!--放款成功-->
						<div class="limit succ" style="display: none;">
							<p>未结清借款使用中</p>
							<div class="moeny">1500</div>
							<button class="getcredits button">我要还款</button>
							<p class="p">点击我要还款查看详情</p>
						</div>
						<!--订单状态-->
						<div class="state" style="display: none;">
							<ul class="progress-of-borrow"></ul>
						</div>
						<!--审核失败-->
						<div class="audit_failure" style="display: none;">
							<img src="static/img/pic_pass.png" />
							<p>审核未通过</p>
							<p>请7天后再次申请</p>
							<button class="getcredits market">查看详情</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</body>
	<script src="static/js/common/jquery.min.js"></script>
	<script src="static/js/common.js"></script>
	<script src="static/js/bridge.js"></script>
	<script src="static/js/common/swiper.min.js"></script>
	<script src="static/js/common/mui.min.js"></script>
	<script>
		var aUrl = apiDomain();
		var webUrl = webDomain();

		default_display();

		function default_display() {
			var token = getToken();
			if(token) {
				$.ajax({
					type: "post",
					url: aUrl + "/order/loan_current_order",
					data: {
						token: token
					},
					async: true,
					dataType: 'JSON',
					success: function(data) {
						if(data.status != 2000) {
							loan_home();
							return
						}
						var obj = data.data;
						if(obj.orderStatus == 0) {
							loan_home();
							return;
						}
						if(obj.orderStatus == 1) {
							displays('.error', '.audit_failure', '.success', '.state');
							var process = obj.loanBeforeList;
							var borrow = '';
							for(var i = 0; i < process.length; i++) {
								borrow += '<li>' +
									'<div class="clearfix">' +
									'<span></span>  ' +
									'<p>' + process[i].event + '</p>' +
									'<p>' + process[i].eventTime + '</p>' +
									'</div>' +
									'<p>' + process[i].eventDescribe + '</p>' +
									'</li>';
							}
							$('.progress-of-borrow').html(borrow);
							return;
						}
						if(obj.orderStatus == 2) {
							//审核失败
							displays('.error', '.state', '.success', '.audit_failure');
							return;
						}
					}
				});
			} else {
				displays('.success', '.audit_failure', '.state', '.error');
			}
		}

		function loan_home() {
			displays('.success', '.audit_failure', '.state', '.error');
			var token = getToken();
			$.ajax({
				type: "post",
				url: aUrl + "/order/loan_home",
				data: {
					token: token,
				},
				async: true,
				dataType: 'JSON',
				success: function(data) {
					var obj = data.data;
					if(data.status == 2000) {
						if(obj.status == 2) {
							$(".server").css({
								'display': 'none'
							});
						}
						$('.moeny').html(obj.amount);
						$('.server').html(obj.descTop);
						$('.gain').html(obj.descMid);
						$('.p').html(obj.descBottom);
						$('.button').attr("data-edu", obj.url);
						$('.button').attr("data-status", obj.status);
					}
				}
			});
		};

		$(".button").on('tap', function() {
			var token = getToken();
			if(!token) {
				closeAndOpen(1);
				return;
			}
			var status = $(this).attr("data-status");
			var href = $(this).attr("data-edu");
			skipPage(0, href);
			if(status == 0) {
				mui.confirm('认证成功了吗？', '提示', ["是", "否"], function(e) {
					loan_home();
				})
			} else if(status == 1) {
				mui.confirm('银行卡绑定成功了吗？', '提示', ["是", "否"], function(e) {
					loan_home();
				})
			} else if(status == 2) {
				mui.confirm('提单成功了吗？', '提示', ["是", "否"], function(e) {
					default_display();
				})
			}
		});

		//审核失败
		$(".market").on('tap', function() {
			skipPage(0, webUrl + 'market.html');
		});

		//立即还款
		$('.repayment').on('tap', function() {
			var orderId = $(this).attr('data-orderId');
			skipPage(0, webUrl + 'order/store_order_detail.html?orderId=' + orderId);
			mui.confirm('还款成功了吗？', '提示', ["是", "否"], function(e) {
				if(e.index == 0) {
					default_display();
				} else {
					default_display();
				}
			})
		});

		//下拉刷新
		mui.init({
			pullRefresh: {
				container: "#refreshContainer", 
				down: {
					contentdown: "下拉可以刷新", //可选，在下拉可刷新状态时，下拉刷新控件上显示的标题内容
					contentover: "释放立即刷新", //可选，在释放可刷新状态时，下拉刷新控件上显示的标题内容
					contentrefresh: "正在刷新...", //可选，正在刷新状态时，下拉刷新控件上显示的标题内容
					callback: function() {
						setTimeout(function() {
							mui('#refreshContainer').pullRefresh().endPulldownToRefresh(false);
							default_display();
						}, 500);
					}
				}
			}
		});

		//显示更多菜单
		$(".gmore").on("tap", function() {
			$(".more").stop().show();
		});
		//隐藏菜单
		$(".more").on('tap', function() {
			$(this).stop().hide();
		});
		
		//跳转
		function apply(url) {
			var token = getToken();
			if(!token) {
				closeAndOpen(1);
				return;
			}
			skipPage(0, webUrl + url);
		};

		function displays(one, two, three, four) {
			$(one).css({'display': 'none'});
			$(two).css({'display': 'none'});
			$(three).css({'display': 'none'});
			$(four).css({'display': 'block'});
		};
		//轮播.
		var mySwiper = new Swiper('.swiper-container', {
			direction: 'vertical',
			autoplay: 2000,
			loop: true,
			auto: true
		});

		$('#scroll').scroll({
			scrollY: true, //是否竖向滚动
			bounce: true, //是否启用回弹
			indicators: false
		});
	</script>

</html>